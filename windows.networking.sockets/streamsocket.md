---
-api-id: T:Windows.Networking.Sockets.StreamSocket
-api-type: winrt class
---

<!-- Class syntax.
public class StreamSocket : Windows.Foundation.IClosable, Windows.Networking.Sockets.IStreamSocket, Windows.Networking.Sockets.IStreamSocket2, Windows.Networking.Sockets.IStreamSocket3
-->

# Windows.Networking.Sockets.StreamSocket

## -description
Supports network communication using a stream socket over TCP or Bluetooth RFCOMM in Windows Store app.

## -remarks
The [StreamSocket](streamsocket.md) class supports network communications that use a stream socket over TCP or Bluetooth RFCOMM in Windows Store app.

For a client app, the most common sequence of operations using a [StreamSocket](streamsocket.md) are the following:


+ Create the [StreamSocket](streamsocket.md).
+ Get a [StreamSocketControl](streamsocketcontrol.md) object using the [Control](streamsocket_control.md) property and set any properties on the [StreamSocketControl](streamsocketcontrol.md) object before calling one of the [ConnectAsync](streamsocket_connectasync.md) methods.
+ Call one of the [ConnectAsync](streamsocket_connectasync.md) methods to establish a connection with the remote endpoint. For Bluetooth, the remote service name is a Bluetooth Service ID. If an SSL/TLS connection for TCP or a level of encryption for Bluetooth is required immediately, this can be specified using some of the [ConnectAsync](streamsocket_connectasync.md) methods. If an SSL/TLS connection is desired after sending and receiving some initial data for a TCP socket, then the [UpgradeToSslAsync](streamsocket_upgradetosslasync.md) method can be called later to upgrade the connection to use SSL.
+ Get the [OutputStream](streamsocket_outputstream.md) property to write data to the remote host.
+ Get the [InputStream](streamsocket_inputstream.md) property to read data from the remote host.
+ Read and write data as needed.
+ Call the [Close](streamsocket_close.md) method to disconnect the socket, abort any pending operations, and release all unmanaged resources associated with the [StreamSocket](streamsocket.md) object.
> [!NOTE]
> The [Close](streamsocket_close.md) method is used by Windows Store app written in JavaScript. For apps written using the .NET Framework 4.5 in C# and VB.NET, the [Close](streamsocket_close.md) method is exposed as the  method on the [StreamSocket](streamsocket.md). For apps written in C++, the [Close](streamsocket_close.md) method will be called when using the delete keyword on the object.

Explicitly closing a [StreamSocket](streamsocket.md) object (calling the [Close](streamsocket_close.md) method) will ensure a graceful disconnect if no pending read or write operations exist on the socket. All pending reads are automatically aborted and the [StreamSocket](streamsocket.md) waits for any ongoing I/O to complete before tearing down the connection. If no unread data remains on the socket after the ongoing I/O is finished, a graceful disconnect (FIN) is guaranteed to occur. Otherwise, an ungraceful disconnect (RST) occurs.

When an active (still connected) [StreamSocket](streamsocket.md) object goes out of scope, an abortive (non-graceful) disconnect may result, which can lead to previously-sent data being discarded before it is read by the remote peer. It is strongly recommended that [Close](streamsocket_close.md) (the [Close](streamsocket_close.md) method in JavaScript, the  method in C# and VB.NET, or the delete operator in C++) be called on a [StreamSocket](streamsocket.md) object before it goes out of scope.

Whenever a read or write operation is cancelled, the I/O operation completes with Error state and the associated [StreamSocket](streamsocket.md) object immediately tears down the connection, which leads to an ungraceful disconnect (RST) if any unread or unsent data remains on the socket.

Ungraceful disconnects (RST) will always occur if: An abnormal termination occurs (e.g., the app crashes); or an abnormal connection failure is detected by the networking stack (e.g., TCP retransmit timeout).

The [StreamSocket](streamsocket.md) object is also used in conjunction with the [StreamSocketListener](streamsocketlistener.md) object to listen for incoming connections over TCP or Bluetooth RFCOMM in server apps or peer-to-peer apps. A [StreamSocket](streamsocket.md) object is returned by the [Socket](streamsocketlistenerconnectionreceivedeventargs_socket.md) property on the [ConnectionReceived](streamsocketlistener_connectionreceived.md) event when a [StreamSocketListener](streamsocketlistener.md) object receives a TCP or Bluetooth RFCOMM connection request. For more information, see [StreamSocketListener](streamsocketlistener.md).

### Support for proxies

In a Windows Store app, the [StreamSocket](streamsocket.md) class supports connecting to a remote endpoint when proxies are required to complete the connection. This support for proxies is automatic and transparent to the app. A [StreamSocket](streamsocket.md) can establish a connection through authenticating proxies as well as through other proxies where authentication is not needed. Authenticating proxies only work if Internet Explorer or an app that uses the [HttpClient](../windows.web.http/httpclient.md) class in the [Windows.Web.Http](../windows.web.http/windows_web_http.md) namespace has previously successfully authenticated with the proxy and the credentials previously used for the authentication are still valid. The support for authenticating proxies does not work if a web browser other than Internet Explorer was used to provide the authentication credentials to the proxy. Connecting through proxies is not supported if a local host address or a specific network adapter is specified on the [ConnectAsync](streamsocket_connectasync.md) method.

In a Windows Store app, the [ConnectAsync](streamsocket_connectasync.md) methods on the [StreamSocket](streamsocket.md) object try to discover proxies and the current proxy configuration both before and after name resolution to help speed up connection establishment. If a port is specified for the endpoint rather than a service name, both proxy discovery and name resolution are initiated internally. If proxy discovery completes before name resolution and the [CanConnectDirectly](../windows.networking.connectivity/proxyconfiguration_canconnectdirectly.md) property on the [ProxyConfiguration](../windows.networking.connectivity/proxyconfiguration.md) object is **false**, then a proxy connection will be attempted. Once name resolution completes, proxy discovery is initiated again with the resolved endpoint address to determine the current proxy configuration. If [CanConnectDirectly](../windows.networking.connectivity/proxyconfiguration_canconnectdirectly.md) indicates after name resolution that the app can connect directly to the remote endpoint, then a socket connection will be attempted directly to the endpoint. If [CanConnectDirectly](../windows.networking.connectivity/proxyconfiguration_canconnectdirectly.md) is **false** after name resolution, then a socket connection will be attempted directly to the endpoint and a parallel socket connection is attempted through the proxy. The first connection to succeed is used by the [StreamSocket](streamsocket.md) and the other connection is canceled.

There may be cases where [CanConnectDirectly](../windows.networking.connectivity/proxyconfiguration_canconnectdirectly.md) returns **false**, yet it does not mean you cannot access the resource directly. A local network could be configured to have support for both a proxy and network address translation (NAT). The WPAD script used to supply proxy information to a web browser or [HttpClient](../windows.web.http/httpclient.md) tells Windows that it should use the proxy. This can cause problems when the remote endpoint is not expecting a proxy connection (an HTTP CONNECT request, for example). An app can use the [GetProxyConfigurationAsync](../windows.networking.connectivity/networkinformation_getproxyconfigurationasync.md) method on the [NetworkInformation](../windows.networking.connectivity/networkinformation.md) object passing the remote endpoint and port for the *uri* parameter to retrieve proxy information to help determine when this condition is suspected. A way to avoid proxy connection requests from being sent when a server can only handle direct connections is to use the [ConnectAsync(HostName, String, SocketProtectionLevel, NetworkAdapter)](streamsocket_connectasync_238604852.md) method, since the proxy-related logic is disabled when a specific network adapter is selected.

In a Windows Phone Store app, the [StreamSocket](streamsocket.md) does not provide automatic support for proxies since the [ProxyConfiguration](../windows.networking.connectivity/proxyconfiguration.md) class is not supported on Windows Phone.

### Handling exceptions

You must write code to handle exceptions when you call asynchronous methods on the [StreamSocket](streamsocket.md) class. Exceptions can result from parameter validation errors, name resolutions failures, and network errors. Exceptions from network errors (loss of connectivity, connection failures, and server failures, for example) can happen at any time. These errors result in exceptions being thrown. If not handled by your app, an exception can cause your entire app to be terminated by the runtime.

The [Windows.Networking.Sockets](windows_networking_sockets.md) namespace has features that simplify handling errors when using sockets. The [GetStatus](socketerror_getstatus.md) method on the [SocketError](socketerror.md) class can convert the **HRESULT** from an exception to a [SocketErrorStatus](socketerrorstatus.md) enumeration value. This can be useful for handling specific network exceptions differently in your app. An app can also use the **HRESULT** from the exception on parameter validation errors to learn more detailed information on the error that caused the exception.

For more information on possible exceptions and how to handle exceptions, see [Handling exceptions in network apps](http://msdn.microsoft.com/library/76fafcc9-c674-4cf8-baa0-2400638fae35).

### Using StreamSocket with Proximity, Wi-Fi Direct, and Bluetooth

Your app can use a [StreamSocket](streamsocket.md) for network connections between devices that are within close range. Classes in the [Windows.Networking.Proximity](../windows.networking.proximity/windows_networking_proximity.md) namespace support network connections with a [StreamSocket](streamsocket.md) to nearby devices that use Bluetooth or Wi-Fi Direct. The [PeerFinder](../windows.networking.proximity/peerfinder.md) and related classes in the [ Windows.Networking.Proximity](../windows.networking.proximity/windows_networking_proximity.md) namespace let your app discover another instance of your app on a nearby device. The [PeerFinder.FindAllPeersAsync](../windows.networking.proximity/peerfinder_findallpeersasync.md) method browses for peer computers that are running the same app within wireless range. The [PeerFinder.ConnectAsync](../windows.networking.proximity/peerfinder_connectasync.md) method returns a connected [StreamSocket](streamsocket.md) that your app can use to transfer network data with the nearby peer app. For more information, see [Supporting proximity and tapping](http://msdn.microsoft.com/library/84a30dcf-ef14-4a93-9e7c-7a3de867d46b), [Windows.Networking.Proximity](../windows.networking.proximity/windows_networking_proximity.md), [PeerFinder](../windows.networking.proximity/peerfinder.md), and the [Proximity sample](http://go.microsoft.com/fwlink/p/?linkid=245082).

Your app can also use a [StreamSocket](streamsocket.md) for network connections between devices that use Wi-Fi Direct with classes in the [Windows.Devices.WiFiDirect](../windows.devices.wifidirect/windows_devices_wifidirect.md) namespace. The [WiFiDirectDevice](../windows.devices.wifidirect/wifidirectdevice.md) class can be used to locate other devices that have a Wi-Fi Direct (WFD) capable device. The [WiFiDirectDevice.GetDeviceSelector](../windows.devices.wifidirect/wifidirectdevice_getdeviceselector.md) method gets the device identifier for a nearby WFD device. Once you have a reference to a nearby WFD device, you can call the [WiFiDirectDevice.GetConnectionEndpointPairs](../windows.devices.wifidirect/wifidirectdevice_getconnectionendpointpairs.md) method to get an [EndpointPair](../windows.networking/endpointpair.md) object. The [ConnectAsync(EndpointPair)](streamsocket_connectasync_13692504.md) or [ConnectAsync(EndpointPair, SocketProtectionLevel)](streamsocket_connectasync_706428084.md) method on the [StreamSocket](streamsocket.md) class can then be used to establish a socket connection. For more information, see [Windows.Devices.WiFiDirect](../windows.devices.wifidirect/windows_devices_wifidirect.md) and [WiFiDirectDevice](../windows.devices.wifidirect/wifidirectdevice.md).

Bluetooth uses Bluetooth Service IDs as endpoints for [StreamSocket](streamsocket.md) connections, not hostnames or IP addresses. To use a [StreamSocket](streamsocket.md) with Bluetooth, the **bluetooth.rfcomm** device capability must be set in the app manifest. For more information, see the [Windows.Devices.Bluetooth.Rfcomm](../windows.devices.bluetooth.rfcomm/windows_devices_bluetooth_rfcomm.md) namespace, [How to specify device capabilities for Bluetooth](XREF:TODO:AppxManifestSchema.how_to_specify_device_capabilities_for_bluetooth), and the [Bluetooth Rfcomm Chat sample](http://go.microsoft.com/fwlink/p/?LinkID=306047).


<!--<section  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <title>Using StreamSocket with Bluetooth and Wifi-Direct</title>
        <sectioncontents>
          <p>Your app can also use a <xref rid="w_net_sock.streamsocket" targtype="class_winrt">StreamSocket</xref> for network connections between devices that are within close range. Classes in the <xref rid="w_net_prox.windows_networking_proximity" targtype="namespace">Windows.Networking.Proximity</xref> namespace support network connections with a <xref rid="w_net_sock.streamsocket" targtype="class_winrt">StreamSocket</xref> that uses Bluetooth or Wi-Fi Direct to nearby devices. The <xref targtype="class_winrt" rid="w_net_prox.peerfinder">PeerFinder</xref> and related classes in the <xref rid="w_net_prox.windows_networking_proximity" targtype="namespace"> Windows.Networking.Proximity</xref> namespace let your app discover another instance of your app on a nearby device.  Your app can then create a <xref rid="w_net_sock.streamsocket" targtype="class_winrt">StreamSocket</xref> connection to the nearby peer app using a tap gesture or by browsing.  For more information, see <xref rid="m_proximity.tapping_portal" targtype="startpage" enabled="1">Supporting proximity and tapping</xref>, <xref rid="w_net_prox.windows_networking_proximity" targtype="namespace" enabled="1">Windows.Networking.Proximity</xref>, <xref targtype="class_winrt" rid="w_net_prox.peerfinder" enabled="1">PeerFinder</xref>, <xref targtype="namespace" rid="w_dvc_blue_rfcomm.windows_devices_bluetooth_rfcomm">Windows.Devices.Bluetooth.Rfcomm</xref>, the <xref hlink="http://go.microsoft.com/fwlink/p/?linkid=245082">Proximity sample</xref>, and the <xref hlink="http://go.microsoft.com/fwlink/p/?LinkID=306047">Bluetooth Rfcomm Chat sample</xref>.</p>
        </sectioncontents>
      </section>-->
### Using StreamSocket on Windows Server 2012

On Windows Server 2012 and Windows Server 2012 R2, the *Windows.Networking.dll* that implements most of the classes in the [Windows.Networking.Sockets](windows_networking_sockets.md) namespace will fail to load unless the Media Foundation feature is enabled. As a result, apps that use [StreamSocket](streamsocket.md) and related socket classes in the [Windows.Networking.Sockets](windows_networking_sockets.md) namespace will fail if the Media Foundation feature is disabled. Windows Server 2012 or Windows Server 2012 R2 installs with the Media Foundation feature disabled.

The Media Foundation feature can be enabled on Windows Server 2012 or Windows Server 2012 R2 using Server Manager or by entering the following text in a command prompt or a script:

`dism /online /enable-feature /featurename:ServerMediaFoundation `After the Media Foundation feature is enabled, the user is prompted to restart. Once the computer is restarted, classes for sockets and WebSockets in the [Windows.Networking.Sockets](windows_networking_sockets.md) namespace will work as expected.

## -examples

## -see-also
[Connecting with sockets ](http://msdn.microsoft.com/library/67cfa78f-570f-4dd4-a0f2-cd6c891f5446), [Connecting with sockets ](http://msdn.microsoft.com/library/2a6448d0-e21f-4963-bca5-aae001ae4fc7), [Handling exceptions in network apps](http://msdn.microsoft.com/library/76fafcc9-c674-4cf8-baa0-2400638fae35), [How to connect with a stream socket ](http://msdn.microsoft.com/library/34f2c556-4cd4-4deb-83fb-1b8fae8a9eb8), [How to connect with a stream socket ](http://msdn.microsoft.com/library/e99c35f6-5aa8-4abf-8e1d-eea46a95d963), [How to secure socket connections with TLS/SSL ](http://msdn.microsoft.com/library/1ad956be-a446-4ffc-a6c3-01e853a8a375), [How to secure socket connections with TLS/SSL ](http://msdn.microsoft.com/library/03399c57-46ec-4cb3-a24d-798a843e036a), [How to set background connectivity options](http://msdn.microsoft.com/library/b6042b5f-5cee-4dee-8cb4-8f376f878e97), [How to specify device capabilities for Bluetooth](XREF:TODO:AppxManifestSchema.how_to_specify_device_capabilities_for_bluetooth), [How to use advanced socket controls ](http://msdn.microsoft.com/library/2e1071d8-a1c7-44c0-b93a-31a701d431c4), [How to use advanced socket controls ](http://msdn.microsoft.com/library/f2c5be73-3461-452e-a38f-d2ddef9b5682), [Supporting proximity and tapping](http://msdn.microsoft.com/library/84a30dcf-ef14-4a93-9e7c-7a3de867d46b), [Troubleshoot and debug network connections](http://msdn.microsoft.com/library/ae3fce58-43ab-4258-9146-755a150e6b50), [ControlChannelTrigger](controlchanneltrigger.md), [IClosable](../windows.foundation/iclosable.md), [NetworkInformation.GetProxyConfigurationAsync](../windows.networking.connectivity/networkinformation_getproxyconfigurationasync.md), [ProxyConfiguration.CanConnectDirectly](../windows.networking.connectivity/proxyconfiguration_canconnectdirectly.md), [PeerFinder](../windows.networking.proximity/peerfinder.md), [SetSocketMediaStreamingMode](http://msdn.microsoft.com/library/5d1c18fc-2f25-44c0-ad3c-f1e7744c4963), [SocketError](socketerror.md), [SocketErrorStatus](socketerrorstatus.md), [StreamSocketControl](streamsocketcontrol.md), [StreamSocketInformation](datagramsocketinformation.md), [StreamSocketListener](streamsocketlistener.md), [StreamSocketListener.ConnectAsync](streamwebsocket_connectasync.md), [WiFiDirectDevice](../windows.devices.wifidirect/wifidirectdevice.md), [Windows.Devices.Bluetooth.Rfcomm](../windows.devices.bluetooth.rfcomm/windows_devices_bluetooth_rfcomm.md), [Windows.Devices.WiFiDirect](../windows.devices.wifidirect/windows_devices_wifidirect.md), [Windows.Networking.Proximity](../windows.networking.proximity/windows_networking_proximity.md), [Bluetooth Rfcomm Chat sample](http://go.microsoft.com/fwlink/p/?LinkID=306047), [ControlChannelTrigger StreamSocket sample](http://go.microsoft.com/fwlink/p/?linkid=243039), [Proximity sample](http://go.microsoft.com/fwlink/p/?linkid=245082), [StreamSocket sample](http://go.microsoft.com/fwlink/p/?linkid=243037), [StreamSocket sample (Windows 10)](http://go.microsoft.com/fwlink/p/?LinkId=620609), [DatagramSocket sample (Windows 10)](http://go.microsoft.com/fwlink/p/?LinkId=620534)

## -capabilities
internetClient, privateNetworkClientServer, ID_CAP_NETWORKING [Windows Phone], bluetooth.rfcomm